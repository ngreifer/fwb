# Recover Bootstrap Weights

`fwb.array()` returns the bootstrap weights generated by
[`fwb()`](https://ngreifer.github.io/fwb/reference/fwb.md).

## Usage

``` r
fwb.array(fwb.out)
```

## Arguments

- fwb.out:

  an `fwb` object; the output of a call to
  [`fwb()`](https://ngreifer.github.io/fwb/reference/fwb.md).

## Value

A matrix with `R` rows and `n` columns, where `R` is the number of
bootstrap replications and `n` is the number of observations in
`boot.out$data`.

## Details

The original seed is used to recover the bootstrap weights before being
reset.

Bootstrap weights are used in computing BCa confidence intervals by
approximating the empirical influence function for each unit with
respect to each parameter (see Examples).

## See also

- [`fwb()`](https://ngreifer.github.io/fwb/reference/fwb.md) for
  performing the fractional weighted bootstrap

- [`boot::boot.array()`](https://rdrr.io/pkg/boot/man/boot.array.html)
  for the equivalent function in boot

See
[`vignette("fwb-rep")`](https://ngreifer.github.io/fwb/articles/fwb-rep.md)
for information on replicability.

## Examples

``` r
set.seed(123, "L'Ecuyer-CMRG")
data("infert")

fit_fun <- function(data, w) {
  fit <- glm(case ~ spontaneous + induced, data = data,
             family = "quasibinomial", weights = w)
  coef(fit)
}

fwb_out <- fwb(infert, fit_fun, R = 300,
               verbose = FALSE)

fwb_weights <- fwb.array(fwb_out)

dim(fwb_weights)
#> [1] 300 248

# Recover computed estimates:
est1 <- fit_fun(infert, fwb_weights[1, ])

stopifnot(all.equal(est1, fwb_out$t[1, ]))

# Compute empirical influence function:
empinf <- lm.fit(x = fwb_weights / ncol(fwb_weights),
                 y = fwb_out$t)$coefficients

empinf <- sweep(empinf, 2L, colMeans(empinf))
```
