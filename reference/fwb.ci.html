<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="fwb.ci() generates several types of equi-tailed two-sided nonparametric confidence intervals. These include the normal approximation, the basic bootstrap interval, the percentile bootstrap interval, the bias-corrected percentile bootstrap interval, and the bias-correct and accelerated (BCa) bootstrap interval."><title>Fractional Weighted Bootstrap Confidence Intervals — fwb.ci • fwb</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fractional Weighted Bootstrap Confidence Intervals — fwb.ci"><meta property="og:description" content="fwb.ci() generates several types of equi-tailed two-sided nonparametric confidence intervals. These include the normal approximation, the basic bootstrap interval, the percentile bootstrap interval, the bias-corrected percentile bootstrap interval, and the bias-correct and accelerated (BCa) bootstrap interval."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">fwb</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ngreifer/fwb/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Fractional Weighted Bootstrap Confidence Intervals</h1>
      <small class="dont-index">Source: <a href="https://github.com/ngreifer/fwb/blob/HEAD/R/fwb.ci.R" class="external-link"><code>R/fwb.ci.R</code></a></small>
      <div class="d-none name"><code>fwb.ci.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>fwb.ci()</code> generates several types of equi-tailed two-sided nonparametric confidence intervals. These include the normal approximation, the basic bootstrap interval, the percentile bootstrap interval, the bias-corrected percentile bootstrap interval, and the bias-correct and accelerated (BCa) bootstrap interval.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fwb.ci</span><span class="op">(</span></span>
<span>  <span class="va">fwb.out</span>,</span>
<span>  conf <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"bc"</span>,</span>
<span>  index <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  h <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/base/identity.html" class="external-link">identity</a></span>,</span>
<span>  hinv <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/base/identity.html" class="external-link">identity</a></span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for fwbci</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span>, hinv <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>fwb.out</dt>
<dd><p>an <code>fwb</code> object; the output of a call to <code><a href="fwb.html">fwb()</a></code>.</p></dd>


<dt>conf</dt>
<dd><p>the desired confidence level. Default is .95 for 95% confidence intervals.</p></dd>


<dt>type</dt>
<dd><p>the type of confidence interval desired. Allowable options include <code>"norm"</code> (normal approximation), <code>"basic"</code> (basic interval), <code>"perc"</code> (percentile interval), <code>"bc"</code> (bias-correct percentile interval), and <code>"bca"</code> (BCa interval). More than one is allowed. Can also be <code>"all"</code> to request all of them. BCa intervals require that the number of bootstrap replications is larger than the sample size.</p></dd>


<dt>index</dt>
<dd><p>the index of the position of the quantity of interest in <code>fwb.out$t0</code> if more than one was specified in <code><a href="fwb.html">fwb()</a></code>. Only one value is allowed at a time. By default the first statistic is used.</p></dd>


<dt>h</dt>
<dd><p>a function defining a transformation. The intervals are calculated on the scale of <code>h(t)</code> and the inverse function <code>hinv</code> applied to the resulting intervals. It must be a function of one variable only and for a vector argument, it must return a vector of the same length. Default is the identity function.</p></dd>


<dt>hinv</dt>
<dd><p>a function, like <code>h</code>, which returns the inverse of <code>h</code>. It is used to transform the intervals calculated on the scale of <code>h(t)</code> back to the original scale. The default is the identity function. If <code>h</code> is supplied but <code>hinv</code> is not, then the intervals returned will be on the transformed scale.</p></dd>


<dt>...</dt>
<dd><p>ignored</p></dd>


<dt>x</dt>
<dd><p>an <code>fwbci</code> object; the output of a call to <code>fwb.ci()</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>An <code>fwbci</code> object, which inherits from <code>bootci</code> and has the following components:</p>
<dl><dt>R</dt>
<dd><p>the number of bootstrap replications in the original call to <code><a href="fwb.html">fwb()</a></code>.</p></dd>

<dt>t0</dt>
<dd><p>the observed value of the statistic on the same scale as the intervals (i.e., after applying <code>h</code> and then <code>hinv</code>.</p></dd>

<dt>call</dt>
<dd><p>the call to <code>fwb.ci()</code>.</p></dd>


</dl><p>There will be additional components named after each confidence interval type requested. For <code>"norm"</code>, this is a matrix with one row containing the confidence level and the two confidence interval limits. For the others, this is a matrix with one row containing the confidence level, the indices of the two order statistics used in the calculations, and the confidence interval limits.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>fwb.ci()</code> functions similarly to <code><a href="https://rdrr.io/pkg/boot/man/boot.ci.html" class="external-link">boot::boot.ci()</a></code> in that it takes in a bootstrapped object and computes confidence intervals. This interface is a bit old-fashioned, but was designed to mimic that of <code>boot.ci()</code>. For a more modern interface, see <code><a href="summary.fwb.html">summary.fwb()</a></code>.</p>
<p>The bootstrap intervals are defined as follows, with \(\alpha =\) 1 - <code>conf</code>, \(t_0\) the estimate in the original sample, \(\hat{t}\) the average of the bootstrap estimates, \(s_t\) the standard deviation of the bootstrap estimates, \(t^{(i)}\) the set of ordered estimates with \(i\) corresponding to their quantile, and \(z_\frac{\alpha}{2}\) and \(z_{1-\frac{\alpha}{2}}\) the upper and lower critical \(z\) scores.</p><ul><li><p><code>"norm"</code> (normal approximation): \([2t_0 - \hat{t} + s_t z_\frac{\alpha}{2}, 2t_0 - \hat{t} + s_t z_{1-\frac{\alpha}{2}}]\)</p></li>
</ul><p>This involves subtracting the "bias" (\(\hat{t} - t_0\)) from the estimate \(t_0\) and using a standard Wald-type confidence interval. This method is valid when the statistic is normally distributed.</p><ul><li><p><code>"basic"</code>: \([2t_0 - t^{(1-\frac{\alpha}{2})}, 2t_0 - t^{(\frac{\alpha}{2})}]\)</p></li>
<li><p><code>"perc"</code> (percentile confidence interval): \([t^{(\frac{\alpha}{2})}, t^{(1-\frac{\alpha}{2})}]\)</p></li>
<li><p><code>"bc"</code> (bias-corrected percentile confidence interval): \([t^{(l)}, t^{(u)}]\)</p></li>
</ul><p>\(l = \Phi\left(2z_0 + z_\frac{\alpha}{2}\right)\), \(u = \Phi\left(2z_0 + z_{1-\frac{\alpha}{2}}\right)\), where \(\Phi(.)\) is the normal cumulative density function (i.e., <code><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm()</a></code>) and \(z_0 = \Phi^{-1}(q)\) where \(q\) is the proportion of bootstrap estimates less than the original estimate \(t_0\). This is similar to the percentile confidence interval but changes the specific quantiles of the bootstrap estimates to use, correcting for bias in the original estimate. It is described in Xu et al. (2020). When \(t^0\) is the median of the bootstrap distribution, the <code>"perc"</code> and <code>"bc"</code> intervals coincide.</p><ul><li><p><code>"bca"</code> (bias-corrected and accelerated confidence interval): \([t^{(l)}, t^{(u)}]\)</p></li>
</ul><p>\(l = \Phi\left(z_0 + \frac{z_0 + z_\frac{\alpha}{2}}{1-a(z_0+z_\frac{\alpha}{2})}\right)\), \(u = \Phi\left(z_0 + \frac{z_0 + z_{1-\frac{\alpha}{2}}}{1-a(z_0+z_{1-\frac{\alpha}{2}})}\right)\), using the same definitions as above, but with the additional acceleration parameter \(a\), where \(a = \frac{1}{6}\frac{\sum{L^3}}{(\sum{L^2})^{3/2}}\). \(L\) is the empirical influence value of each unit, which is computed using the regression method described in <code><a href="https://rdrr.io/pkg/boot/man/empinf.html" class="external-link">boot::empinf()</a></code>. The acceleration parameter corrects for bias and skewness in the statistic. It can only be used when clusters are absent and the number of bootstrap replications is larger than the sample size. When \(a=0\), the <code>"bca"</code> and <code>"bc"</code> intervals coincide.</p>
<p>Interpolation on the normal quantile scale is used when a non-integer order statistic is required, as in <code><a href="https://rdrr.io/pkg/boot/man/boot.ci.html" class="external-link">boot::boot.ci()</a></code>. Note that unlike with <code><a href="https://rdrr.io/pkg/boot/man/boot.ci.html" class="external-link">boot::boot.ci()</a></code>, studentized confidence intervals (<code>type = "stud"</code>) are not allowed.</p>
    </div>
    <div class="section level2">
    <h2 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a></h2>
    
<ul><li><p><code>print(fwbci)</code>: Print a bootstrap confidence interval</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="fwb.html">fwb()</a></code> for performing the fractional weighted bootstrap; <code><a href="get_ci.html">get_ci()</a></code> for extracting confidence intervals from an <code>fwbci</code> object; <code><a href="summary.fwb.html">summary.fwb()</a></code> for producing clean output from <code><a href="fwb.html">fwb()</a></code> that includes confidence intervals calculated by <code>fwb.ci()</code>; <code><a href="https://rdrr.io/pkg/boot/man/boot.ci.html" class="external-link">boot::boot.ci()</a></code> for computing confidence intervals from the traditional bootstrap; <code><a href="vcovFWB.html">vcovFWB()</a></code> for computing parameter estimate covariance matrices using the fractional weighted bootstrap</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"infert"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">w</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">case</span> <span class="op">~</span> <span class="va">spontaneous</span> <span class="op">+</span> <span class="va">induced</span>, data <span class="op">=</span> <span class="va">data</span>,</span></span>
<span class="r-in"><span>             family <span class="op">=</span> <span class="st">"quasibinomial"</span>, weights <span class="op">=</span> <span class="va">w</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fwb_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="fwb.html">fwb</a></span><span class="op">(</span><span class="va">infert</span>, <span class="va">fit_fun</span>, R <span class="op">=</span> <span class="fl">199</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Bias corrected percentile interval</span></span></span>
<span class="r-in"><span><span class="va">bcci</span> <span class="op">&lt;-</span> <span class="fu">fwb.ci</span><span class="op">(</span><span class="va">fwb_out</span>, index <span class="op">=</span> <span class="st">"spontaneous"</span>, type <span class="op">=</span> <span class="st">"bc"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bcci</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> BOOTSTRAP CONFIDENCE INTERVAL CALCULATIONS</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Based on 199 bootstrap replicates</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CALL : </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fwb.ci(fwb.out = fwb_out, type = "bc", index = "spontaneous")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intervals : </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Level BC Percentile  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 95%   ( 0.711,  1.617 )  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Calculations and Intervals on Original Scale</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Some bias-corrected percentile intervals may be unstable</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Using `get_ci()` to extract confidence limits</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="get_ci.html">get_ci</a></span><span class="op">(</span><span class="va">bcci</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $bc</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         L         U </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.7105262 1.6170316 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"conf")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.95</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Interval calculated on original (log odds) scale,</span></span></span>
<span class="r-in"><span><span class="co"># then transformed by exponentiation to be on OR</span></span></span>
<span class="r-in"><span><span class="fu">fwb.ci</span><span class="op">(</span><span class="va">fwb_out</span>, index <span class="op">=</span> <span class="st">"induced"</span>, type <span class="op">=</span> <span class="st">"norm"</span>,</span></span>
<span class="r-in"><span>       hinv <span class="op">=</span> <span class="va">exp</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> BOOTSTRAP CONFIDENCE INTERVAL CALCULATIONS</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Based on 199 bootstrap replicates</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CALL : </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fwb.ci(fwb.out = fwb_out, type = "norm", index = "induced", hinv = exp)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intervals : </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Level       Normal   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 95%   ( 1.026,  2.229 )  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Calculations on Original Scale  but Intervals Transformed</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Noah Greifer.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer></div>

  

  

  </body></html>

