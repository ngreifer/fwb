<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="fwb() implements the fractional (random) weighted bootstrap, also known as the Bayesian bootstrap. Rather than resampling units to include in bootstrap samples, weights are drawn to be applied to a weighted estimator."><title>Fractional Weighted Bootstrap — fwb • fwb</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fractional Weighted Bootstrap — fwb"><meta property="og:description" content="fwb() implements the fractional (random) weighted bootstrap, also known as the Bayesian bootstrap. Rather than resampling units to include in bootstrap samples, weights are drawn to be applied to a weighted estimator."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">fwb</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ngreifer/fwb/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Fractional Weighted Bootstrap</h1>
      <small class="dont-index">Source: <a href="https://github.com/ngreifer/fwb/blob/HEAD/R/fwb.R" class="external-link"><code>R/fwb.R</code></a></small>
      <div class="d-none name"><code>fwb.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>fwb()</code> implements the fractional (random) weighted bootstrap, also known as the Bayesian bootstrap. Rather than resampling units to include in bootstrap samples, weights are drawn to be applied to a weighted estimator.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fwb</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">statistic</span>,</span>
<span>  R <span class="op">=</span> <span class="fl">999</span>,</span>
<span>  cluster <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  simple <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  cl <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for fwb</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span>, digits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"digits"</span><span class="op">)</span>, index <span class="op">=</span> <span class="fl">1L</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">t</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p>the dataset used to compute the statistic</p></dd>


<dt>statistic</dt>
<dd><p>a function, which, when applied to <code>data</code>, returns a vector containing the statistic(s) of interest. The function should take at least two arguments; the first argument should be <code>data</code> to accept the dataset and the second argument should be <code>w</code> to accept a vector of weights. Any further arguments can be passed to <code>statistic</code> through the <code>...</code> argument.</p></dd>


<dt>R</dt>
<dd><p>the number of bootstrap replicates. Default is 999 but more is always better. For the percentile bootstrap confidence interval to be exact, it can be beneficial to use one less than a multiple of 100.</p></dd>


<dt>cluster</dt>
<dd><p>optional; a vector containing cluster membership. If supplied, will run the cluster bootstrap. See Details. Evaluated first in <code>data</code> and then in the global environment.</p></dd>


<dt>simple</dt>
<dd><p><code>logical</code>; if <code>TRUE</code>, weights will be computed on-the-fly in each bootstrap replication rather than all at once. This can save memory at the cost of some speed.</p></dd>


<dt>verbose</dt>
<dd><p><code>logical</code>; whether to display a progress bar.</p></dd>


<dt>cl</dt>
<dd><p>a cluster object created by <code><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">parallel::makeCluster()</a></code>, or an integer to indicate the number of child-processes (integer values are ignored on Windows) for parallel evaluations. See <code><a href="https://rdrr.io/pkg/pbapply/man/pbapply.html" class="external-link">pbapply::pblapply()</a></code> for details. If <code>NULL</code>, no parallelization will take place.</p></dd>


<dt>...</dt>
<dd><p>other arguments passed to <code>statistic</code>.</p></dd>


<dt>x</dt>
<dd><p>an <code>fwb</code> object; the output of a call to <code>fwb()</code>.</p></dd>


<dt>digits</dt>
<dd><p>the number of significant digits to print</p></dd>


<dt>index</dt>
<dd><p>the index or indices of the position of the quantity of interest in <code>x$t0</code> if more than one was specified in <code>fwb()</code>. Default is to print all quantities.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A <code>fwb</code> object, which also inherits from <code>boot</code>, with the following components:</p>
<dl><dt>t0</dt>
<dd><p>The observed value of <code>statistic</code> applied to <code>data</code> with uniform weights.</p></dd>

<dt>t</dt>
<dd><p>A matrix with <code>R</code> rows, each of which is a bootstrap replicate of the result of calling <code>statistic</code>.</p></dd>

<dt>R</dt>
<dd><p>The value of <code>R</code> as passed to <code>fwb()</code>.</p></dd>

<dt>data</dt>
<dd><p>The <code>data</code> as passed to <code>fwb()</code>.</p></dd>

<dt>seed</dt>
<dd><p>The value of <code>.Random.seed</code> just prior to generating the weights (after the first call to <code>statistic</code> with uniform weights).</p></dd>

<dt>statistic</dt>
<dd><p>The function <code>statistic</code> as passed to <code>fwb()</code>.</p></dd>

<dt>call</dt>
<dd><p>The original call to <code>fwb()</code>.</p></dd>

<dt>cluster</dt>
<dd><p>The vector passed to <code>cluster</code>, if any.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>fwb()</code> implements the fractional weighted bootstrap and is meant to function as a drop-in for <code>boot::boot(., stype = "f")</code> (i.e., the usual bootstrap but with frequency weights representing the number of times each unit is drawn). In each bootstrap replication, the weights are sampled from independent exponential distributions with rate parameter 1 and then normalized to have a mean of 1, equivalent to drawing the weights from a Dirichlet distribution. The function supplied to <code>statistic</code> must incorporate the weights to compute a weighted statistic. For example, if the output is a regression coefficient, the weights supplied to the <code>w</code> argument of <code>statistic</code> should be supplied to the <code>weights</code> argument of <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code>. These weights should be used any time frequency weights would be, since they are meant to function like frequency weights (which, in the case of the traditional bootstrap, would be integers). Unfortunately, there is no way for <code>fwb()</code> to know whether you are using the weights correctly, so care should be taken to ensure weights are correctly incorporated into the estimator.</p>
<p>When fitting binomial regression models (e.g., logistic) using <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code>, it may be useful to change the <code>family</code> to a "quasi" variety (e.g., <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">quasibinomial()</a></code>) to avoid a spurious warning about "non-integer #successes".</p>
<p>The cluster bootstrap can be requested by supplying a vector of cluster membership to <code>cluster</code>. Rather than generating a weight for each unit, a weight is generated for each cluster and then applied to all units in that cluster.</p>
<p>Ideally, <code>statistic</code> should not involve a random element, or else it will not be straightforward to replicate the bootstrap results using the <code>seed</code> included in the output object. Setting a seed using <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code> is always advised.</p>
<p>The <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> method displays the value of the statistics, the bias (the difference between the statistic and the mean of its bootstrap distribution), and the standard error (the standard deviation fo the bootstrap distribution).</p>
    </div>
    <div class="section level2">
    <h2 id="methods-by-generic-">Methods (by generic)<a class="anchor" aria-label="anchor" href="#methods-by-generic-"></a></h2>
    
<ul><li><p><code>print(fwb)</code>: Print an <code>fwb</code> object</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="fwb.ci.html">fwb.ci()</a></code> for calculating confidence intervals; <code><a href="summary.fwb.html">summary.fwb()</a></code> for displaying output in a clean way; <code><a href="plot.fwb.html">plot.fwb()</a></code> for plotting the bootstrap distributions; <code><a href="vcovFWB.html">vcovFWB()</a></code> for estimating the covariance matrix of estimates using the FWB; <code><a href="https://rdrr.io/pkg/boot/man/boot.html" class="external-link">boot::boot()</a></code> for the traditional bootstrap.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Performing a Weibull analysis of the Bearing Cage</span></span></span>
<span class="r-in"><span><span class="co"># failure data as done in Xu et al. (2020)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"bearingcage"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">weibull_est</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">w</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/survreg.html" class="external-link">survreg</a></span><span class="op">(</span><span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">hours</span>, <span class="va">failure</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>                           data <span class="op">=</span> <span class="va">data</span>, weights <span class="op">=</span> <span class="va">w</span>,</span></span>
<span class="r-in"><span>                           dist <span class="op">=</span> <span class="st">"weibull"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>eta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, beta <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">fit</span><span class="op">$</span><span class="va">scale</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">boot_est</span> <span class="op">&lt;-</span> <span class="fu">fwb</span><span class="op">(</span><span class="va">bearingcage</span>, statistic <span class="op">=</span> <span class="va">weibull_est</span>,</span></span>
<span class="r-in"><span>                R <span class="op">=</span> <span class="fl">199</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">boot_est</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FRACTIONAL WEIGHTED BOOTSTRAP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fwb(data = bearingcage, statistic = weibull_est, R = 199, verbose = FALSE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bootstrap Statistics :</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         original         bias   std. error</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> t1* 11792.178173 1.115550e+04 37526.170789</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> t2*     2.035319 1.727336e-01     0.883811</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Get standard errors and CIs; uses bias-corrected</span></span></span>
<span class="r-in"><span><span class="co">#percentile CI by default</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">boot_est</span>, ci.type <span class="op">=</span> <span class="st">"bc"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Estimate Std. Error CI 2.5 % CI 97.5 %</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> eta  1.18e+04   3.75e+04 2.81e+03  7.47e+04</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> beta 2.04e+00   8.84e-01 1.15e+00  5.38e+00</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Plot statistic distributions</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">boot_est</span>, index <span class="op">=</span> <span class="st">"beta"</span>, type <span class="op">=</span> <span class="st">"hist"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="fwb-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Noah Greifer.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer></div>

  

  

  </body></html>

